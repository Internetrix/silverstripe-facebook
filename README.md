# Module Template

[![Build Status](link)]
[![Scrutinizer Code Quality](link)]
[![codecov](link)]
[![Version](link)]
[![License](link)]


## Introduction

Adds a link to the Silverstripe SiteConfig that prompts login from the User. Once logged in, an Auth Token is generated 
that is automatically extended to have a Long Access Period. This token can then be accessed by custom code for use in
generating social feeds.

A 'Manual Override' feature has been added to allow manual setting of an access token if required.

## Requirements
* SilverStripe CMS: ^4.0
* facebook/graph-sdk: ^5.7
* unclecheese/display-logic: ^2.0.1

## Installation

```
composer require internetrix/silverstripe-facebook
```

## Quickstart

Please include the following configs to enable the connection:

```
Internetrix\Facebook\Config:
  facebook_public_token: 'your-public-token-here'
  facebook_secret_token: 'your-secret-token-here'
```

Schedule the `facebook-validation` task to run at minimum weekly to allow refreshing of Access Tokens.

## TODO

* Implement proper error handling and reporting for User
* Implement script to auto-determine Profile ID
* Allow customisation of permissions?
* If access expires due to password change, add notifications to prompt user to reauthenticate
* Style the Login button to look like a Facebook Login button
* Implement logout/de-auth function
* Display Access Token field if in Dev environment/specific config enabled?
* Create a Job for the Validation Task using the Queued Jobs module? Necessary?
* Add below Page Access Token script to Helper Trait, add error handling

# Notes

This currently only generates a User Access Token. Converting/creating a Page Access Token is fairly straightforward with Guzzle:

```
$client = new Client();
$request = $client->request('GET', 'https://graph.facebook.com/' . $yourProfileID . '?fields=access_token&access_token=' . $yourOriginalAccessToken);
$response = $request->getBody()->getContents();
$accessToken = json_decode($response, true)['access_token'];
```

`$yourProfileID` is the numeric ID of the Facebook account you're gathering the pages for. 

`$yourOriginalAccessToken` is the token generated by this module.
